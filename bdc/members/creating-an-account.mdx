---
title: "Creating an Account"
---

## How-To

1. Navigate to the [sign-up](https://www.bergendebate.com/sign-up) page.
2. Fill in required fields (and provide a <u>valid email address</u>) **\<TODO: What are we considering a valid email address?\>**
5. Create a password.
6. Submit the form to create your account.

The platform supports multiple account types to ensure proper role-based access and family linking.

### Parent Accounts

**Required Fields:** First & Last Name, Email Address

### Student Accounts

**Required Fields:** First & Last Name, Parent Name &  Email Address

**Note:** The parent email address is used to link the student account to a parent account via the `familyId`.

### Coach Accounts

**Required Fields:** First & Last Name, Email Address

<Warning>
  There is no way for an admin to create an account for a user. This is contemplated future functionality. If such a need arises, let the tech team know, and we can manually do this
</Warning>

## Technical Details

To create an account, we do the following:

1. What APIs get called, and what function do they serve. Brief sketch of logic, and the other services that get
2. What does the MongoDB schema look like for a created account
3. Add in any differences in the flow for parent vs student vs coach accounts

## Technical Steps Involved in Account Creation

**1: Memberstack**

Once the user submits the **Sign Up** form (via the Webflow UI), Memberstack creates the user record in **Memberstack’s internal database **(after validating email & password). Memberstack generates a unique `memberId` for the user.

On member cretaion, Memberstack triggers the below webhook.

### 1.1 `POST /camp/createUserSignup `

Entry-point API to initiate account signup and synchronize data between Webflow & Memberstack.

**Responsibilities:**

- Accepts signup payload: `name`, `email`, `accountType` (student | parent | coach), `signUpRef`
  - **TODO: Eventually, we'll just point to the OpenAPI reference for input payload signature...**
  - **TODO: Please note and/or confirm here that payload is structured based on payload that Memberstack sends via webhook.**
- **Webflow Insertion:** Formats the payload into Webflow's CMS-compatible structure. Inserts into Webflow CMS's **Member** collection and publishes the CMS item.
- **Webflow ↔ Memberstack linkage:** Receives `itemId` from Webflow in the response. Finds member in Memberstack via the payload's `memberId`.  Updates Memberstack record with `webflow-member-id = itemId` .
- Invokes `createAccount` service to persist data into MongoDB, with different arguments passed depending on if sign-up was from `student` or `parent`.
- After the Webflow ↔ Memberstack linkage and successful MongoDB account creation, the signup flow performs **CRM lead synchronization and referral state updates**.

  **CRM Lead Creation / Update**
  - Once `createAccount` succeeds, the API receives the created `student_id` and `parent_id`.
  - The system invokes the internal CRM endpoint:

    POST /api/v1/external/create-lead
  - A lead is created or updated in the CRM with:
    - `parent_id` (always present)
    - `student_id` (only if a student account was created)
    - `tag_name = "account created"`
    - `ref_id = memberId` (Memberstack memberId for traceability)
  - This ensures all signups are reflected in CRM for follow-ups, onboarding, and sales workflows.
- **Referral Status Update**
  - The system checks the `referral_details` collection using the created parent’s MongoDB `_id` as `guestId`.
  - If a referral record exists:
    - The referral stage is updated to:   referred_stage = "Signed_Up"
    - `updated_on` timestamp is set
- This marks the referral lifecycle transition from **invited / referred → signed up**.
- Purchase-based referral progression is handled later during payment completion (not at signup).
- Invitation / Account-Exists Emails
  - When a signup email matches an existing invited user or a pre-existing account, SES is triggered via: `sendEmail.SendEmail.send_to_email(...)`
  - This occurs inside helper flows such as `setFamilyId()` when:
    - A user was previously invited
    - The system links the new signup to an existing family
  - Email templates are fetched from the `email_content` collection and sent via SES.

### 1.2 `POST /camp/createAccount`

Creates or updates the user account record in MongoDB, based on if `student` or `parent` data was passed in.

**Responsibilities:**

- If **student or parent records already exist** without a `memberId`:
  - Updates the existing record with: `memberId`, `itemId`, `name`, `email`
- Else, creates a new record for the student or parent.
  - If record is a `student`, then link to the `parent` record (which is also created, if does not exist)
  - FamilyId Logic

    `familyId` is the **primary grouping key** used to associate parents and students belonging to the same household. The logic is centralized in the `createAccount` flow and behaves as follows:

    **1. Parent-first ownership model**
    - The **parent record is treated as the source of truth** for `familyId`.
    - When a signup request contains a `parentEmail`, the system first searches for an existing parent account using that email.

    **2. FamilyId generation**
    - If no existing parent is found:
      - A new `familyId` is generated using a random, non-guessable string derived from the parent email and digits.
      - This `familyId` is assigned at parent creation time.
    - If an existing parent is found:
      - If the parent already has a valid `familyId`, it is reused.
      - If the parent exists but has an empty or `"null"` familyId, a new one is generated and backfilled.

    **3. Student linkage**
    - Students are always linked to a parent \*\*via the same \*\*`familyId`.
    - Student lookup follows this order:
      - By `studentEmail` (if provided and different from parent email)
      - Else by `(studentName + familyId)`
    - If a student record exists without a `familyId`, it is updated to inherit the parent’s `familyId`.
    - If no student record exists, a new student is created with the inherited `familyId`.

---

## 2. MongoDB Account Schema

TODO: For SK to review after above is finalized.

### 2.1 Account Document (Common Structure)

```
{
  "_id": ObjectId,
  "name": "Full Name",
  "email": "user@example.com",
  "itemId": "webflow_item_id",
  "familyId": "family_identifier",
  "accountType": "student | parent | coach",
  "memberId": "memberstack_member_id",
  "firstName": "First",
  "lastName": "Last",
  "createdOn": ISODate,
  "updatedOn": ISODate,
  "utm_source": "",
  "signUpRef": ""
}
```

---

### 2.2 Student Account Example

```
{
  "name": "Diksha Singh",
  "email": "diksha.singh@techment.com",
  "itemId": "",
  "familyId": "r8tt097r1D58i1ti",
  "accountType": "student",
  "memberId": "",
  "firstName": "Diksha",
  "lastName": "Singh",
  "school": "ABC-10",
  "studentGrade": "6th Grade",
  "gender": "Female",
  "dob": "",
  "createdOn": "2026-01-14T06:51:34.477Z",
  "updatedOn": "2026-01-14T07:18:33.222Z",
  "utm_source": "",
  "signUpRef": ""
}
```

---

### 2.3 Student Account (Signup from Cart)

```
{
  "name": "Rahul Student",
  "email": "rahul.student@techment.com",
  "itemId": "",
  "familyId": "",
  "accountType": "student",
  "memberId": "",
  "firstName": "Rahul",
  "lastName": "Student",
  "school": "ABC-10",
  "studentGrade": "9th Grade",
  "gender": "Male",
  "createdOn": "2026-01-15T10:49:07.947Z",
  "utm_source": "",
  "signUpRef": "cart_page"
}
```

---

## 3. Differences by Account Type

| Account Type | Extra Fields Required | Can Exist Without memberId | Update-on-Signup |
| :----------- | :-------------------- | :------------------------- | :--------------- |
| Student      | school, grade, gender | Yes                        | Yes              |
| Parent       | phone                 | Yes                        | Yes              |
| Coach        | None                  | No                         | No               |

---

## 5. Key Notes

- Webflow acts as the **source of truth for CMS items**
- MemberStack is linked to post-Webflow item creation
- MongoDB supports **partial pre-existing records** that are completed during signup
- `familyId` enables grouping of parent–student relationships

---

This flow ensures consistent data synchronization across Webflow, Memberstack, and MongoDB while supporting flexible signup entry points (direct signup, cart-based signup, and admin-created records).