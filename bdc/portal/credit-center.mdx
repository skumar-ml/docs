---
title: "Credit Center"
---

TODO: Shubham, provide some overview of BDC credits here

## Non-Technical

### Overview

The [Credit Center](https://www.bergendebate.com/portal/credit-balance) web page shows the user how much credit they currently have and how it has been used over time.

![Image](/images/image-35.png)

- **Credit Balance** at the top displays the total available credit amount that can be applied toward payments.
- The **Credit Transaction History** section lists all credit activity in a table:
  - **Type** – indicates whether the credit was added (**Credit**) or deducted (**Debit**).

## Admins (Retool)

There are two Retool pages for managing credits. The [Credit Center](https://bergendebate.retool.com/apps/2cdaaa88-6f1f-11ef-b711-f7b5e1b8821c/2024%20phase%202/Credit%20Center) is best for bulk credits. [View Credit](https://bergendebate.retool.com/apps/1e8644de-6f55-11ef-a73b-6f14815b8360/2024%20phase%202/View%20Credit) is best for seeing how much balance parents already have, their transaction history, or adding credits to a few parents.

### Credit Center

The [Credit Center](https://bergendebate.retool.com/apps/2cdaaa88-6f1f-11ef-b711-f7b5e1b8821c/2024%20phase%202/Credit%20Center) Retool page allows admins to **bulk add** monetary credits to parent accounts.

1. **Select Parents:** admin should set filters to narrow down the parents. Select parents (they will move to table on the right)
2. **Add Credits:** Enter the \*\*Credit Amount (\$) \*\*and **Description** (reason for the credit)

### View Credits

The [View Credit](https://bergendebate.retool.com/apps/1e8644de-6f55-11ef-a73b-6f14815b8360/2024%20phase%202/View%20Credit)  Retool page allows admins to view existing parent credit balances, review transaction history, and update credits.

**Update Credit**\
This feature allows to update the credit amount for a parent account and add a short description. The description is displayed to users on their portal.

![Image](/images/image-37.png)

**View Credit History**\
This shows the complete credit transaction history for a parent, including debit/credit entries, amount, session, and year.

![Image](/images/image-36.png)

## Technical

### Overview

Credits are stored per parent (member) in `member_credit_amount`. Admins add credits via **Retool** (which updates this collection). Deductions happen when a parent applies credit during an **invoice payment** or **checkout**; the Stripe webhook (`stripePaymentListener`) updates `member_credit_amount` and appends a **debit** entry to `credit_history`. The Credit page fetches GET `getCreditBalance` and renders balance and transaction history via `credit_points.js` (`CreditBalance` class). For the **BDC Credits modal shown during checkout**, see the [checkout](#) and [invoices ](#)docs; this section does not detail that modal.

### API and data source

- **API:** ****`GET getCreditBalance`****
- **Response**: `creditBalance` object with `name`, `email`, `memberId`, `creditBalance` (number), `creditHistory` (array of logs), `createdOn`, `updatedOn`.

### DB collection and structure

**member_credit_amount** — One document per parent (member). Holds current credit balance and full transaction history. Used by the Credit Center page and by Retool / Stripe webhook.

| Field              | Description                                              |
| :----------------- | :------------------------------------------------------- |
| **\_id**           | MongoDB ObjectId.                                        |
| **memberId**       | Parent (member) identifier.                              |
| **emailID**        | Parent email.                                            |
| **createdOn**      | When the document was created.                           |
| **updatedOn**      | Last update time (e.g. after balance or history change). |
| **credit_balance** | Current available credit amount (number).                |
| **credit_history** | Array of credit/debit entries (see below).               |

**credit_history** array item:

| Field                         | Description                                                                               |
| :---------------------------- | :---------------------------------------------------------------------------------------- |
| **amount**                    | Credit added (positive) or debit applied (negative).                                      |
| **type**                      | e.g. `"credit"`, `"debit"`, `"RemovedAdmin"`.                                             |
| **createdOn**                 | When the entry was created.                                                               |
| **description**               | Reason or context (e.g. "Referral Code", "Pro-Rated Tuition", "used in invoice payment"). |
| **sessionId**                 | Optional; session identifier.                                                             |
| **year**                      | Optional; year.                                                                           |
| **session**                   | Optional; nested session object (e.g. classSessionName, registrationDates).               |
| **invoiceId** / **paymentId** | Optional; for debits, links to invoice or payment.                                        |

- **Credits:** Admins add credits via Retool. Retool updates `member_credit_amount`: sets `credit_balance` (increased) and pushes an entry to `credit_history` with `type` "credit"  and the `description`. The **amount** will always be positive.
  - If the added credit amount is **negative** (e.g., to remove credits), then `type` is "RemovedAdmin"
- **Debits:** After any successful payment (invoice or checkout), the `stripePaymentListener` runs. It calls `calculateInvoiceAmount`  to get the new `credit_balance` and amount applied; then the balance of the appropriate `member_credit_amount` record is updated, and we **\$push** to **credit_history** an entry with **type** `"debit"`, `description`. The **amount** will always be negetive

### Portal Rendering (Credit Center page)

- **JS file:** `credit_points.js`, `CreditBalance` class.
- **Entry:** The Credit Center page instantiates `CreditBalance` with a `data` object that includes `apiBaseURL` and `memberId`.
- The process starts by showing a loading spinner and hiding the balance, transaction list, and “no record” message. It then requests credit balance data from the server.
- If the request succeeds, it stores the total credit balance and transaction history. Next, it displays the updated balance and fills the transaction table. After that, the spinner is hidden and the main content becomes visible.
- If there’s an error or no data is returned, a “no records found” message is shown instead.
- The balance display shows the total credit amount formatted as dollars.
- **DOM:** Balance: `[data-credit="balance"]`. Table container: `[data-credit="table"]`. No-record state: `[data-container="no-record-found"]`. Wrapper: `.portal-info-wrapper`.
- For the transaction list, existing rows are cleared, transactions are sorted from newest to oldest, and each entry is shown with:
  - Date
  - Type (Credit or Debit — admin removals count as Debit)
  - Session name with year
  - Description
  - Amount (positive for credit, negative for debit)
