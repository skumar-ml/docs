---
title: "Returner Conversion + Pre-Registration"
---

## Non-Technical

TODO: What users get to see for both returner conversion & pre-registration. I think there's a few different states here, so you can cover all of them

1. Returner conversion viewS
2. Returner conversion + pre-registration (before AND after pre-registration period)
3. Only Pre-registration (?)

### Pre-Registration

![Image](/images/image-65.png)

### Returner conversion + pre-registration

![Image](/images/image-51.png)

- This section shows the **current pre-registration status** and countdown.
- Clicking **Register Now** navigates the user directly to the **Stripe payment page**.
- Clicking **Learn More** opens a **Next Recommended Program** popup.

### Next Recommended Program Popup

![Image](/images/image-50.png)

- Highlights the next recommended program along with available offers, expiry countdown, and guidance on the next step.

## Admins (Retool)

TODO: How can admin returner conversion on Retool. Pre-Reg management was already discussed (link to doc)

### Manage Returner Conversion

The [Returner Conversion](https://bergendebate.retool.com/apps/385a97e8-695f-11f0-94e7-d3db21f5beef/Q2%6025/Manage%20Recommended%20Level) page helps admins manage recommendations for **returning students**, meaning students who have previously enrolled and are eligible to continue to the next level.\
Admins can review and update the recommended next level and grade, apply filters to find specific students, and publish or unpublish recommendations to control what appears on the user portal.

![Image](/images/image-43.png)

### **Pre-Reg Management**

Please refer to the Pre-Registration Management details from the document URL: bdc/checkout-systems/semester/pre-reg-system.

## Technical

Returner conversion and pre-registration on the portal are driven by **one API(**`getPortalDetails`**)** and the `Portal` class in the` portal.js`. The API returns **recommendedLevel**(when published) and futureSession (with pre-registration dates); the frontend shows/hides the “Next Recommended Program” and pre-reg blocks and buttons based on that data and the current date

### **API (**`getPortalDetails/{memberId}`)

In this api returns all student records for the family, including current recommendation program data. With the help of the recommendation program.

For each student in the family & the **current** session, if the student's recommendation has `publish==True`, the API returns `recommendedLevel`

`Return: recommendedLevel` (when published)

| Field                     | Description                                      |
| :------------------------ | :----------------------------------------------- |
| **session**               | Session identifier from recommendation.          |
| **level**                 | Recommended level from **class_level**.          |
| **year**                  | Year.                                            |
| **pre-registrationDates** | Pre-registration window for this recommendation. |
| **earlyBirdDeadlineDate** | Early-bird deadline.                             |
| **registrationStartDate** | Start of registration window.                    |
| **registrationEndDate**   | End of registration window.                      |

**futureSession** (from payment/upsell data) includes **pre-registrationDates**, **programDates**, **earlyBirdDeadlineDate**, **classId** (empty when bundle not yet converted). Used for pre-reg timing and “has bundle” logic.

`Return: futureSession` (from payment/upsell data)

| Field                     | Description                                                                                                     |
| :------------------------ | :-------------------------------------------------------------------------------------------------------------- |
| **pre-registrationDates** | Pre-reg window for future session.                                                                              |
| **programDates**          | Program dates.                                                                                                  |
| **earlyBirdDeadlineDate** | Early-bird deadline.                                                                                            |
| **classId**               | Class id once converted; **empty** when bundle not yet converted (used for “has bundle” / pre-reg eligibility). |

<Note>
  TODO: This section is messy right now:

  1. Explain conditions (e.g., For each student in the family & the **current** session, if the student's recommendation (in the `members` collection) has `publish==True`) **Removed members text and updated the description**
  2. Explain the return, in some detail. Might want to use a table **Updated Description**
</Note>

### **JS** ( `portal_new_ui.js`  class: `Portal`)

Portal fetches **getPortalDetail** once; then, for each student tab it renders that student’s data, including the “Next Recommended Program” and pre-registration block.

**How returner conversion and pre-reg work together**

Whether the user sees anything in this area depends on two things: (1) the API returned a **recommendedLevel** for that student (backend only sends it when the recommendation is published), and (2) whether the student has a **future-session bundle** (from upsell: a future session with \*\*no classId \*\*).

The code then checks the **current date** against two time windows via **getTimeBasedVisibility(recommendedLevel, studentData)**:

- **Pre-registration window** — from **futureSession**: between `pre-registrationDates.preRegStartDate` and `programDates.startDate`. When the user is in this window and has a bundle, the pre-reg block is shown and they can complete pre-reg (e.g. “Register Now” only).
- **Registration window** — from **recommendedLevel**: between `pre-registrationDates.preRegStartDate` and `registrationEndDate`. When the user is in this window and has a published recommendation, the “Next Recommended Program” line and both “Register Now” and “Learn More” can show.

Accordingly, **updateButtonVisibility** shows or hides **Register Now** and **Learn More**:

- During pre-reg only (bundle + in pre-reg window): **Register Now** only.
- During registration (published recommendation + in registration window): both **Register Now** and **Learn More**.
- If both pre-reg and registration are active, both buttons can show; otherwise both are hidden and the section is hidden.

**Register Now and Learn More**

- **Register Now** (`#enroll-now-btn-2` on the page; `#enroll-now-btn` inside the modal)\
  Clicking **Register Now** goes to a URL that is set from **recommendedLevel** and the current registration window:
  - **When returner conversion is active and today is within the registration window:** the link is `https://www.bergendebate.com/programs/{levelUrl}` (e.g. `programs/level-3b` for Level 3B). The user is sent to that program/level page in a **new tab**.
  - **Otherwise:** the link is `https://www.bergendebate.com/classes-overview`. The user is sent to the classes overview in a **new tab**.
- **Learn More** (`[data-portal="next-recomm-learn-more"]`)\
  Clicking **Learn More** opens the **#next-recomm-modal** overlay. The modal is filled with data from the current student and **recommendedLevel**:
  - **Title:** “Next Step for [student name]”.
  - **Recommended line:** “Recommended: [session year | level]” (or session/year, level, or grade if some fields are missing).
  - **Early-bird countdown:** If **recommendedLevel** has `earlyBirdDeadlineDate`, a countdown to that deadline is shown in the modal.
  - **Enroll Now button:** The modal has its own **Register Now** button; its link uses the same logic as above (programs/level when in registration window, else classes-overview), and it also opens in a new tab.
  - **“Why This Program”:** Short copy recommending the level for that student.\
    Closing the modal (e.g. backdrop or close control) hides it; the modal does not navigate the page.

<Note>
  TODO: Rewrite to explain the following:

  1. Conditions can be simplified -- obviously, publish is true. So non-empty `recommendedLevel` is really the only condition, right . **YES, publish  is true or false for the backed logic**
  2. Instead of just having independent bullet points, explain how they are connected. So for example, you reference **updateButtonVisibility**
     1. Explain what that does, and a little of how it works.
     2. Alternatively, you don't even need to reference minor methods. You can just explain the functionality that executes. This might make the docs easier.
</Note>