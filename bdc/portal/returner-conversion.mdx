---
title: "Returner Conversion + Pre-Registration"
---

## Non-Technical

TODO: What users get to see for both returner conversion & pre-registration. I think there's a few different states here, so you can cover all of them

### Pre-Registration View

![Image](/images/image-51.png)

- This section shows the **current pre-registration status** and countdown.
- Clicking **Register Now** navigates the user directly to the **Stripe payment page**.
- Clicking **Learn More** opens a **Next Recommended Program** popup.

### Next Recommended Program Popup

![Image](/images/image-50.png)

- Shows the **next recommended program** for the user.
- Highlights any **available offers or discounts** (if applicable).
- Displays an **offer expiry countdown**.
- Helps users understand their **next step before proceeding**.

## Admins (Retool)

TODO: How can admin returner conversion on Retool. Pre-Reg management was already discussed (link to doc)

### Manage Returner Conversion

The [Returner Conversion](https://bergendebate.retool.com/apps/385a97e8-695f-11f0-94e7-d3db21f5beef/Q2%6025/Manage%20Recommended%20Level) page helps admins manage recommendations for **returning students**, meaning students who have previously enrolled and are eligible to continue to the next level.\
Admins can review and update the recommended next level and grade, apply filters to find specific students, and publish or unpublish recommendations to control what appears on the user portal.

![Image](/images/image-43.png)

### **Pre-Reg Management**

Please refer to the Pre-Registration Management details from the document URL: bdc/checkout-systems/semester/pre-reg-system.

## Technical

Returner conversion and pre-registration on the portal are driven by **one API** and the `Portal` class in the portal JS. **`~~~~~~The API returns recommendedLevel(when published) and ~~ futureSession~~~~~~`** (with pre-registration dates); the frontend shows/hides the “Next Recommended Program” and pre-reg blocks and buttons based on that data and the current date.~~

**API (**`getPortalDetails/{memberId}`)

- For each student in the family & the **current** session, if the student's recommendation has `publish==True`, the API returns `recommendedLevel`
- **`getRecommended(row)`** runs only when **`row['publish'] == True`**; it reads **attendance_session**, **class_session**, **student_grades**, **class_level** and returns **session**, **grade**, **level**, **year**, **pre-registrationDates**, **earlyBirdDeadlineDate**, **registrationStartDate**, **registrationEndDate**. If not published, returns `{}`.
- **futureSession** (from payment/upsell data) includes **pre-registrationDates**, **programDates**, **earlyBirdDeadlineDate**, **classId** (empty when bundle not yet converted). Used for pre-reg timing and “has bundle” logic.

<Note>
  TODO: This section is messy right now:

  1. Explain conditions (e.g., For each student in the family & the **current** session, if the student's recommendation (in the `members` collection) has `publish==True`)
  2. Explain the return, in some detail. Might want to use a table
</Note>

\*\*JS \*\*( `portal_new_ui.js`  class: `Portal`)

Portal fetches **getPortalDetail/** once; then for each student tab it calls **renderRecommendedLevel(tabPane, student, studentData)**.

**Returner conversion**

- **Returner conversion** = “Next Recommended Program” is shown when the API returns a non-empty **recommendedLevel** (i.e. **recommendedLevel.level** is set), i.e. when **publish** is true and **getRecommended** has level/session/year/dates.
- **renderRecommendedLevel** uses **recommendedLevel** to fill the “Next Recommended Program” line (session/year | level) and to drive **updateButtonVisibility** and **getTimeBasedVisibility**.

<Note>
  TODO: Rewrite to explain the following:

  1. Conditions can be simplified -- obviously, publish is true. So non-empty `recommendedLevel` is really the only condition, right
  2. Instead of just having independent bullet points, explain how they are connected. So for example, you reference **updateButtonVisibility**
     1. Explain what that does, and a little of how it works.
     2. Alternatively, you don't even need to reference minor methods. You can just explain the functionality that executes. This might make the docs easier.
</Note>

**Pre-registration (portal)**

- **checkHasBundle(studentData)** = student has a future-session bundle (no **classId** yet, non-Summer) so they can pre-register. Uses **studentData.futureSession**.
- **getTimeBasedVisibility(recommendedLevel, studentData)** compares current date to **pre-registrationDates** (from futureSession) and to **recommendedLevel.pre-registrationDates** / **registrationEndDate**; returns **showPreRegistration** and **showRegistration**.
- **updateButtonVisibility(recommendedSection, recommendedLevel, timeBasedVisibility, studentData)** shows/hides **#enroll-now-btn-2** and **[data-portal="next-recomm-learn-more"]** based on:
  - **hasBundle** and **timeBasedVisibility.showPreRegistration** → Register Now only (pre-reg).
  - **hasReturnerConversion** and **timeBasedVisibility.showRegistration** → both buttons (returner conversion during registration).
  - Both active → both buttons; otherwise both hidden and section hidden.

**DOM**

- **`[data-pre-registration="container"]`** — wrapper for “Next Recommended Program” + pre-reg.
- **`.next-recomm-prog-container`** — “Next Recommended Program” block; **`.pre-reg-container`** — pre-reg block.
- **`[data-portal="next-recomm-prog-text"]`** — session/year | level line; **`.next-recomm-prog-title`** — “Next Recommended Program for name”.
- **`#enroll-now-btn-2`**, **`[data-portal="next-recomm-learn-more"]`** — Register Now and Learn More. **updateEnrollNowLinks** sets Register Now href to programs/level when returner conversion is active and within registration window, else classes-overview.
- **Learn More** opens **#next-recomm-modal**; **updateModalContent** fills it from **recommendedLevel**.