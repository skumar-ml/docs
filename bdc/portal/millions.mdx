---
title: "Millions"
---

## Non-Technical

### Overview

This [Millions](https://www.bergendebate.com/portal/millions) page allows users to monitor their Millions balance, view detailed transaction history, and manage credits or rewards associated with each student.

![Image](/images/image-23.png)

**Current Balance: **This section shows the **current available Millions balance** for the selected student.

**Transactions:**  displays the history of Millions activity for the selected student. Each entry shows the transaction **date, description,** and the **amount** added or deducted (± Millions).

## Admins (Retool)

### Manage “Million Items” in Retool

[This page](https://bergendebate.retool.com/apps/65bce3c6-5749-11f0-93e7-5bde07f21a93/Q2%6025/Millions%20Items/page1) allows you to update the millions store (view/edit existing items, add new ones).

<Info>
  Currently, we are not making use of the Millions Store
</Info>

### Millions Dashboard Retool

The [Millions Dashboard](https://bergendebate.retool.com/apps/95b9c6b4-ed69-11f0-98f8-e7d3bb45fb10/Q1%6026/Millions_Dashboard%20Q1%6026/page1) displays a list of students **based on the selected filters** such as year, session, location, class level, or student name. For each student record, you can view their million balance.

**Available actions include:**

- **Edit Millions** – Opens a popup to add or adjust Millions with a brief description.

  ![Image](/images/image-30.png)
- **View Transaction** – Opens a popup showing the student’s Millions transaction history.

  ![Image](/images/image-32.png)

## Technical

<Warning>
  Note: Please skip the BDC Millions store for now, since we aren't using it

  SK -- let's get BDC admin to populate this
</Warning>

### **Database Details**

**millions_transactions** — One document per student (keyed by `studentId`). Used by the Millions page and by the read/write APIs.

| Field            | Description                                   |
| :--------------- | :-------------------------------------------- |
| **\_id**         | MongoDB ObjectId.                             |
| **studentId**    | Student identifier (links to member/student). |
| **earnAmount**   | Current total Millions balance.               |
| **createdOn**    | When the document was created.                |
| **transactions** | Array of transaction entries (see below).     |

_Optional or joined when read:_ `name`, `email`, `memberId`, `studentId` may appear when the API joins with **members**; the stored document may only have `studentId`, `earnAmount`, `createdOn`, `transactions`.

**transactions** array item:

| Field            | Description                        |
| :--------------- | :--------------------------------- |
| **amount**       | Delta added (+) or deducted (-).   |
| **description**  | Optional text for the transaction. |
| **lastEarnDate** | Date of the transaction.           |

**millions_items_details** — Catalog for the Millions store (skipped for now).

### **Flow**

1. **JS (**`MillionsRenderer`**)** — init and request
   - File: `millions.js`; class: `MillionsRenderer`.
   - Parent page must pass `apiBaseURL` and `memberId` to `MillionsRenderer` class 
   - Caches DOM: `#half-circle-spinner` (loading), `.portal-info-wrapper` (main content wrapper), `[data-container="no-record-found"]` (empty state), `.portal-tab` (tab container).
   - Shows spinner, hides portal content and no-record div, then calls `GET getMillionsTransactionData/{memberId}`.
2. **API (getMillionsTransactionData.py)**
   - The read API filters **which students** appear using current year/session (students with a payment in that term); each student's balance is their total (not per-session).

   <Warning>
     TODO: We need to update code to not just look for student in the current year/session. It should be any student that is in `payment_details`
   </Warning>
   - Resolves `memberId` to family; uses current year/session to get students with a payment in that term; for each, reads `millions_transactions` by `studentId`.
   - Returns `millions_transactions` with `studentName, studentGrade, earnAmount, transactions` (and optionally **items** for store; page ignores **items**).
3. **JS (MillionsRenderer)** — after response
   - **Content switch:** If `millions_transactions` is missing or empty: show `no-record-found`, hide portal wrapper and spinner; return. Otherwise: hide spinner, show `.portal-info-wrapper` and `.portal-tab`.
   - **Tab menu:** Fills `.portal-tab-menus` with one `.portal-tab-link` per student (student name); first tab has **w--current**.
   - **Tab panes:** Fills `.portal-tab-content` with one `.w-tab-pane` per student; each pane has Current Balance (`.million-price-text`), "View Store" link, and Transactions table (`.transactions-table-div` with header row and `.transactions-row-wrapper` for rows).
   - **Render each tab:** For each student, `renderTab` writes balance into `.million-price-text`, sorts `transactions` by `lastEarnDate` (newest first), and appends rows (date, description, amount with green-semi-bold / red-semi-bold for +/-). If no transactions, shows "No Record Found" in that pane.
   - **Sidebar:** Updates `[data-millions="sidebarCount"]` with the first student's **earnAmount** (e.g. "1,234M"); parent is shown.
   - **Tab switching:** Listens on `.portal-tab-link` clicks; on switch, toggles `w--current / w--tab-active`, re-runs `renderTab` for the selected index to refresh that pane's display, and updates `[data-millions="sidebarCount"]` to the selected student's balance.

### **Sidebar and main content**

- **Millions menu** — Sidebar shows balance for the selected student in `[data-millions="sidebarCount"]` as "XM" (e.g. "1,234M"). The parent element is shown/hidden and updated when the user switches student tabs.
- **Main content** depends on API response:
  - **Has **`millions_transactions`**:** Show the Millions UI (student tabs, Current Balance, Transactions table per student). First student is selected by default; sidebar shows that student's balance.
  - **No millions_transactions (empty or error):** Show `[data-container="no-record-found"]` (no records message), hide `.portal-info-wrapper` and `.portal-tab`.
