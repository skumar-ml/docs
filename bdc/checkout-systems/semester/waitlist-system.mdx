---
title: "Waitlist System"
---

## How User Enrolls in Waitlist System

The Waitlist System allows parents to register students for fully booked classes.\
When a spot becomes available, waitlisted users can be invited. Once payment is completed, the user is automatically removed from the waitlist.

If the class is full during checkout, the user will see an option to enroll in the class's "Waitlist".

![Image](/images/image-1.png)

<Note>
  There is no upper limit to the number of classes a user can join the waitlist for.
</Note>

<Danger>
  TODO: The Waitlist system page on Retool is not showing the proper details on the "Students List". Please update this.
</Danger>

## Admin Management

Admin can view all users in waitlist for classes through the [Waitlist Center](https://bergendebate.retool.com/apps/6d587fde-b8a9-11f0-abcf-4f17f8e87830/Student%20Consolidation/Waitlist_Center_Speedup%20-%20SC). Only classes with users in the waitlist are shown here.

**If the admin invites a user**, we _reserve_ the open spot for the user. <u>The admin can only invite the user if they is an open spot in the class!</u> The user (who must be logged into that account) is able to checkout for the class as normal. Any other user will see that the class is full and be prompted to join the waitlist.

<Note>
  Remember to uninvite the user for the class if they are no longer interested to free the spot. Another option is to open the slot to the public after reserving it for 48 hours.
</Note>

## Technical Details

TODO: Give technical details of how waitlist collections and APIs. What happens after waitlist user purchases? Are they auto-removed from waitlist? Describe how leftSpots calculation changes according to waitlisted users...

### Database Collection: waitlist_details

| Field         | Purpose                                        |
| ------------- | ---------------------------------------------- |
| \_id          | MongoDB unique document identifier             |
| submissionId  | Jotform submission ID                          |
| memberId      | Parent member ID                               |
| formId        | Jotform form ID                                |
| studentId     | Student member ID (MongoDB ObjectId as string) |
| classId       | Class unique identifier (`classUniqueId`)      |
| prevStudent   | ndicates previous student (`Yes` / `No`)       |
| prevSemesters | Previous semesters attended                    |
| created_on    | Timestamp when record was created              |
| invite        | Invitation status (optional boolean)           |

### APIs & Services

**JotForm Webhook(** **signupAndWaitlistHandler)**

We use the Jotform webhook **signupAndWaitlistHandler** to handle waitlist signups. It parses the Jotform submission and checks for duplicate waitlist entries using **classId + submissionId**.

The handler then calls the **createAccount** API to create the parent and student accounts. If the accounts already exist, the API returns the existing **parentId** and **studentId**; otherwise, it creates new accounts and returns the newly generated IDs.

Finally, the user is added to the **waitlist_details** collection. If the user is already waitlisted, the process is skipped.

**Lambda function (inviteUninviteUser)**

This handles sending invites to waitlisted users when seats are available. It can also remove invites if needed. The invite status is updated in the **waitlist_details** collection, and emails are sent to inform users.

### Automatic Removal After Purchase

When a Stripe payment is marked as **Complete** or **Processing**, the system checks if the user was on the waitlist. If so, the corresponding entry is automatically and permanently removed from the **waitlist_details** collection.

### LeftSpots calculation changes for waitlisted users

Normal users take confirmed seats in the class. **Invited and waitlisted users** temporarily hold seats even though they havenâ€™t completed payment yet. If the person viewing the class is invited and on the waitlist, the system still shows one seat available for them. If they are not invited and waitlisted, all invited and waitlisted users reduce the number of seats shown as available.

### Email Notifications

Handled by `inviteUninviteUser`. and sent Invitation and Uninvitation emails