---
title: "Web Checkout"
---

## Classes Overview Page

Most checkout journeys begin from the [classes overview page](https://www.bergendebate.com/classes-overview).

TODO: Explain how data from the semester overview page is populated

The **Semester Overview** page displays class offerings for a selected semester (e.g., Winter/Spring 2026, Fall). Data is populated from multiple sources and organized by grade level tabs.

---

## Page Structure

The Semester Overview page is divided into two main tabs:

- **GRADES 5–8**
- **GRADES 9+**

Each tab displays a list of class levels with expandable rows for additional details.

---

## Data Sources Overview

| Data Type                 | Source                 |
| :------------------------ | :--------------------- |
| Class Level & Metadata    | Webflow CMS            |
| Syllabus Details          | MongoDB (via API)      |
| Class Location & Schedule | MongoDB (via API)      |
| Registration Flow         | Cart / Checkout System |

---

## Class Level Listing

Inside each grade tab, classes are displayed by **Level** with basic information.

### Level Information

**Examples:**\
Level 1A, Level 1B, Level 2A … Level X, Customized Learning, World Schools

**Source:**

- Webflow collection item

---

### Prerequisite

**Examples:**

- New Student
- Level 1A
- New Student or Level 1B

**Source:**

- Webflow collection item

---

### Suggested Grades

**Examples:**

- 5–6
- 7–8
- 9–11
- 1–12

**Source:**

- Webflow  collection item

---

## View Syllabus

- Displayed as a **button** for each class level.
- When clicked:
  1. A modal window opens.
  2. The class syllabus content is loaded dynamically.

**Source:**

- MongoDB database
- Retrieved via API based on the selected class level

---

## Register Button

- Displayed as a **Register** button for each class level.
- When clicked:
  - User is redirected to the **cart page** to register for the selected class.

**Source:**

- Registration and cart logic handled by the enrollment system

---

## Class Location & Schedule (Expandable Row)

- When a **class level row is clicked**, it expands to show:
  - Class locations (e.g., Fort Lee, Glen Rock, Livingston)
  - Days and times for each location

**Source:**

- MongoDB database
- Retrieved via API based on:
  - Class level
  - Semester
  - Grade tab selection

---

## Data Flow Summary

1. **Webflow CMS**
   - Provides class level metadata (Level name, prerequisite, suggested grades).
2. **MongoDB via API**
   - Provides syllabus details.
   - Provides class location and schedule information.
3. **Frontend UI**
   - Combines CMS and API data into a unified class catalog experience.
4. **Registration Flow**
   - Redirects users to the cart page for enrollment.

     ![Image](/images/image.png)

## Cart Page

<Steps>
  <Step title="New Step">
    TODO: Explain steps of checkout here. Keep this non-technical
  </Step>
</Steps>

## Overview

The checkout flow follows a **multi-step form**:

1. Student Details
2. Optional Bundle Program Selection
3. Class Selection & Payment

Each step must be completed before moving to the next.

---

## Step 1: Student Details

Parents begin by entering or selecting student information.

### Saved Student Profiles

- A dropdown allows parents to select an existing student profile.
- Selecting a saved student automatically fills in the form fields.

### Student Information Fields

- Student First Name
- Student Last Name
- Email Address
  - If the student does not have an email, the parent’s email can be used.
- Student Grade
- Student School Name
- Student Gender
- Has your child participated in a BDC class before?

### Next Button

- Clicking **Next** saves the student information.
- After saving, a popup appears to offer discounted bundle programs for future sessions.

---

## Step 2: Bundle Program (Optional)

A popup appears allowing families to pre-register for future sessions at a discounted rate.

### Bundle Options

- Users can select one or more future sessions to bundle.
- Bundling allows families to:
  - Lock in current pricing
  - Receive early-bird discounts

### Skipping the Bundle

- Users can skip this step by clicking **“No Thanks”**.
- The checkout process continues whether or not a bundle is selected.

---

## Step 3: Class Selection & Payment

### Select Class Location

- Users must first choose a location, such as:
  - Glen Rock
  - Fort Lee
  - Livingston
  - Online

### Select Class Time

- Available time slots appear after selecting a location.
- Example times:
  - Friday 4:00 PM – 6:00 PM
  - Sunday 9:30 AM – 11:30 AM
  - Saturday 12:00 PM – 2:00 PM

### Seat Availability Messages

Users may see messages such as:

- “Hurry! Register now. Seats filling up fast! Only 1 spot left.”
- “Seats are full. You can fill out the waitlist form below.”
- “Seats are full. Please fill out the waitlist form.”

---

## Payment Options

Payment options become available once a class time and location are selected and seats are available.

### Available Payment Methods

- Bank Transfer (includes a discount)
- Credit Card

### Completing Payment

1. Select a payment method.
2. Click **Buy Now**.
3. You are redirected to the secure Stripe checkout page.
4. Enter payment details.
5. Complete payment.

### After Payment

- Upon successful payment, the user is redirected to a confirmation (success) page.
- The student is officially registered for the class.

---

## Additional Options During Checkout

### Bundle Program Banner

- Displays selected bundle programs.
- Allows users to add or modify bundle selections during checkout.

### Bergen Briefs

- Optional learning briefs can be added alongside class registration.
- Users can choose full or light versions with displayed pricing.

### Student Info Panel

- Displays the selected student’s information for confirmation.

### Order Details Panel

- Shows:
  - Selected class and location
  - Selected class time
  - Any bundled future programs
  - Bergen Briefs selections
  - Pricing and totals

---

## Summary

The checkout process ensures:

- Student information is captured first
- Families can optionally save money with future session bundles
- Class selection is based on real-time availability
- Payment is secure and straightforward
- All selections are clearly summarized before completion

TODO: Give a technical explanation of how checkout page works (before payment). Things to explain are the saved student profiles, the new student fee determination, the sign-up / log-in redirect, how class time and locations are added in, the number of spots calculation.

## Checkout System

### Before Payment

TODO: Explain the payment options, how the checkout links are created, what happens when user is directed to Stripe, what happens if user returns back from Stripe page

### Overview

This document explains the available payment options, how Stripe checkout links are created, what happens when users are redirected to Stripe, and how the system restores state when users return from the Stripe payment page.

---

### Payment Options

### Available Payment Methods

The system provides two payment options for class registration:

### 1. Bank Transfer (ACH)

- **Label**: Bank Transfer
- **Discount**: 3% discount applied to the total amount
- **Default Selection**: Selected by default
- **Processing**: Secure ACH payment handled by Stripe
- **User Experience**:
  - User selects Bank Transfer as the payment method
  - Stripe securely handles bank authorization and payment
  - No bank details are stored by the system
- **Price Calculation**: Base price with 3% discount applied

---

### 2. Credit Card

- **Label**: Credit Card
- **Fee**: Additional processing fee applied
- **Processing**: Standard credit/debit card payment via Stripe
- **Price Calculation**: Base price plus processing fee\
  _(approximately 2.9% + \$0.30)_

---

### Payment Option Selection

- Payment options are displayed using a tab-based interface
- Users can switch between **Bank Transfer** and **Credit Card**
- The selected payment option determines which Stripe checkout URL is generated
- Pricing updates dynamically:
  - **Bank Transfer** → Discounted total
  - **Credit Card** → Total including processing fee

---

### When Payment Options Are Displayed

Payment options appear when:

- A class time slot is selected
- The class has available seats (not waitlisted)
- The user account type is not `student`
- For bundle purchases, payment options appear only when supplementary programs or briefs are selected

---

## Checkout Link Creation

### Overview

When the user proceeds to payment, the system creates a Stripe checkout session based on the selected payment method.

---

### Step 1: Credit Application Check

- A modal prompts the user to apply available Bergen credits
- User selects **Apply** or **Skip**
- The selection is saved as `applyCredit` and included in checkout data

---

### Step 2: Data Preparation

The following data is collected before generating the checkout link:

#### Required Fields

- `checkoutId` – Existing checkout session ID (from localStorage)
- `label` – Class description (Location | Level | Time)
- `classUniqueId` – Selected class identifier
- `location` – Selected location
- `memberId` – Webflow member ID
- `upsellProgramIds` – Selected supplementary program IDs
- `has_fee` – Indicates if new student fee applies
- `source` – Always set to `cart_page`
- `amount` – Final amount in cents
- `applyCredit` – Credit usage flag
- `successUrl` – Redirect URL after successful payment
- `cancelUrl` – Redirect URL if payment is cancelled

#### Additional Fields for Bundle Purchases

- `paymentId` – Bundle payment identifier
- `isBundleProgram` – Boolean flag
- `topics` – Selected brief topics (if applicable)

---

### Step 3: API Call

Depending on the purchase type, one of the following APIs is called:

#### Standard Checkout

- **Endpoint**: `updateDataToCheckoutUrl`
- **URL**:\
  `https://nqxxsp0jzd.execute-api.us-east-1.amazonaws.com/prod/camp/updateDataToCheckoutUrl`

Used for:

- Single class registration
- Bundle purchases without supplementary programs

---

#### Supplementary Checkout

- **Endpoint**: `checkoutUrlForUpsellProgram`
- **URL**:\
  `https://nqxxsp0jzd.execute-api.us-east-1.amazonaws.com/prod/camp/checkoutUrlForUpsellProgram`

Used for:

- Bundle purchases with supplementary programs or briefs

---

### Step 4: API Response

The API returns:

```
{
  "success": true,
  "cardUrl": "https://checkout.stripe.com/...",
  "achUrl": "https://checkout.stripe.com/..."
}
```

---

### Step 5: Redirect to Stripe

Based on the selected payment method:

- **Credit Card** → Redirect to `cardUrl`
- **Bank Transfer** → Redirect to `achUrl`

Before redirecting:

- `backbuttonstate` is set to `"1"`
- Checkout data is saved to `localStorage`
- API response is stored for restoration

---

## Stripe Checkout Experience

### On the Stripe Page

Once redirected to Stripe:

1. User reviews payment details
2. Enters required payment information
3. Confirms payment
4. Stripe processes the transaction securely

Stripe manages:

- Payment authentication
- Session lifecycle
- Secure handling of payment details

---

## Returning from Stripe

### Possible Return Scenarios

---

### 1. Successful Payment

**Redirect URL Pattern**:

```
payment-confirmation?type=Academic&programName={label}&pType={paymentType}
```

**System Behavior**:

- Payment is confirmed
- Registration is completed
- User sees confirmation screen

---

### 2. Cancelled Payment

**Redirect URL Pattern**:

```
?returnType=back
```

**System Behavior**:

- Checkout state is restored from localStorage
- All user selections and form data are reloaded
- User can resume checkout

---

### 3. Browser Back Button

**Detection Logic**:

- `backbuttonstate === "1"`
- `returnType=back` exists
- Checkout data exists and is valid

**Behavior**:

- Same restoration logic as cancelled payment
- User resumes from last completed step

---

## State Restoration Process

When restoring checkout state, the system:

1. Validates checkout data (member ID & timestamp)
2. Restores student information
3. Reloads selected location and class time
4. Restores selected payment method
5. Recalculates totals
6. Restores bundle and supplementary selections
7. Updates UI steps and validations

---

## Data Persistence

### LocalStorage Keys

- `checkOutData`
- `checkOutBasicData`

Includes:

- Student info
- Selected class
- Payment method
- Bundle selections
- Creation timestamp

### After Payment

TODO: Explain everything that happens after payment. What APIs get triggered, what writes happen in the DB, where user gets directed after, any automated emails